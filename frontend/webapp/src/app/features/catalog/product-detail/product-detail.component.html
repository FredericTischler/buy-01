<section class="mx-auto w-full max-w-5xl px-4 py-10">
  <button hlmBtn variant="ghost" size="sm" class="mb-6" type="button" (click)="goBack()">
    ← Retour au catalogue
  </button>

  @if (loading()) {
    <div class="grid gap-8 lg:grid-cols-[minmax(0,1.2fr)_minmax(0,1fr)]">
      <ui-card>
        <div class="space-y-4">
          <ui-skeleton height="360px" />
          <div class="grid grid-cols-4 gap-3">
            @for (i of [1, 2, 3, 4]; track i) {
              <ui-skeleton height="80px" />
            }
          </div>
        </div>
      </ui-card>
      <ui-card>
        <div class="space-y-4">
          <ui-skeleton height="28px" width="70%" />
          <ui-skeleton height="20px" width="40%" />
          <ui-skeleton height="16px" width="90%" />
          <ui-skeleton height="16px" width="75%" />
          <ui-skeleton height="16px" width="60%" />
        </div>
      </ui-card>
    </div>
  } @else {
  @if (product(); as product) {
      <div class="grid gap-8 lg:grid-cols-[minmax(0,1.2fr)_minmax(0,1fr)]">
        <ui-card>
          <div class="space-y-4">
            <div class="relative overflow-hidden rounded-xl bg-muted">
              @if (product.images?.length) {
                <img
                  [src]="product.images[selectedImageIndex()]?.url"
                  [alt]="product.images[selectedImageIndex()]?.alt || product.name"
                  class="h-[360px] w-full object-cover"
                />
                <button
                  type="button"
                  class="absolute left-3 top-1/2 flex h-9 w-9 -translate-y-1/2 items-center justify-center rounded-full border border-border bg-background/80 text-sm shadow"
                  (click)="previousImage()"
                  aria-label="Image précédente"
                >
                  ‹
                </button>
                <button
                  type="button"
                  class="absolute right-3 top-1/2 flex h-9 w-9 -translate-y-1/2 items-center justify-center rounded-full border border-border bg-background/80 text-sm shadow"
                  (click)="nextImage()"
                  aria-label="Image suivante"
                >
                  ›
                </button>
              } @else {
                <div class="flex h-[360px] items-center justify-center text-muted-foreground">
                  Aucune image disponible pour le moment.
                </div>
              }
            </div>

            @if (product.images?.length) {
              <div class="grid grid-cols-4 gap-3">
                @for (
                  image of product.images;
                  track trackByImage($index, image);
                  let index = $index
                ) {
                  <button
                    type="button"
                    class="overflow-hidden rounded-lg border-2 transition"
                    [class.border-primary]="selectedImageIndex() === index"
                    [class.border-transparent]="selectedImageIndex() !== index"
                    (click)="selectImage(index)"
                  >
                    <img
                      [src]="image.url"
                      [alt]="image.alt || product.name"
                      class="h-20 w-full object-cover"
                    />
                  </button>
                }
              </div>
            }
          </div>
        </ui-card>

        <ui-card>
          <div class="space-y-5">
            <div class="space-y-2">
              <ui-badge variant="outline">{{ product.currency }}</ui-badge>
              <h1 class="text-3xl font-semibold text-foreground">{{ product.name }}</h1>
              <p class="text-lg font-semibold text-primary">
                {{ product.price | currency: product.currency : 'symbol-narrow' : 'fr-FR' }}
              </p>
            </div>

            <div class="space-y-2 text-sm text-muted-foreground">
              <p>{{ product.description }}</p>
              <div class="grid gap-1">
                <span class="font-medium text-foreground">Vendu par</span>
                <span>
                  {{ product.seller?.profile?.firstName || product.seller?.email }}
                  {{ product.seller?.profile?.lastName || '' }}
                </span>
              </div>
            </div>

            <div
              class="rounded-lg border border-border bg-muted/30 p-4 text-sm text-muted-foreground"
            >
              <div class="flex items-center justify-between">
                <span>Stock disponible</span>
                <span class="font-medium text-foreground">{{ product.stock ?? 'N.C.' }}</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Dernière mise à jour</span>
                <span>{{ product.updatedAt | date: 'mediumDate' : '' : 'fr' }}</span>
              </div>
            </div>
          </div>
        </ui-card>
      </div>
    } @else {
      <div
        class="rounded-lg border border-dashed border-border p-8 text-center text-muted-foreground"
      >
        Ce produit est introuvable.
      </div>
    }
  }
</section>
