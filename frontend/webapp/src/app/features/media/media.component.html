<section class="mx-auto w-full max-w-6xl px-4 py-10">
  <header class="mb-6">
    <h1 class="text-3xl font-semibold tracking-tight text-foreground">Gestion des médias</h1>
    <p class="text-sm text-muted-foreground">
      Téléversez vos images produits (≤ 2 MB) et récupérez leurs identifiants pour les associer à
      vos fiches.
    </p>
  </header>

  <div
    class="relative mb-8 rounded-xl border-2 border-dashed border-border bg-muted/40 p-8 text-center transition"
    [ngClass]="dragActive() ? ['border-primary', 'bg-primary/10'] : []"
    (drop)="onDrop($event)"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
  >
    <div class="space-y-3">
      <p class="text-sm text-muted-foreground">
        Glissez-déposez vos images ici ou utilisez le sélecteur de fichiers.
      </p>
      <input
        id="media-upload"
        type="file"
        accept="image/*"
        multiple
        class="hidden"
        (change)="onFileChange($event)"
      />
      <label hlmBtn variant="secondary" for="media-upload" class="cursor-pointer"
        >Sélectionner des fichiers</label
      >
      @if (uploading()) {
        <p class="text-xs text-primary">Téléversement en cours...</p>
      }
    </div>
  </div>

  @if (loading()) {
    <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      @for (skeleton of [1, 2, 3, 4, 5, 6]; track skeleton) {
        <ui-card>
          <div class="space-y-3">
            <ui-skeleton height="160px" />
            <ui-skeleton height="16px" width="80%" />
            <ui-skeleton height="14px" width="60%" />
          </div>
        </ui-card>
      }
    </div>
  } @else {
    @if (mediaItems().length) {
      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        @for (media of mediaItems(); track media.id) {
          <ui-card>
            <div class="space-y-3">
              <div class="overflow-hidden rounded-lg bg-muted">
                <img [src]="media.url" [alt]="media.filename" class="h-40 w-full object-cover" />
              </div>
              <div class="space-y-1 text-sm">
                <p class="font-medium text-foreground truncate">{{ media.filename }}</p>
                <p class="text-xs text-muted-foreground">Format : {{ media.mimeType }}</p>
                <p class="text-xs text-muted-foreground">
                  Taille : {{ media.size / 1024 | number: '1.0-0' }} Ko
                </p>
                <p class="text-xs text-muted-foreground">
                  Ajouté le {{ media.createdAt | date: 'mediumDate' : '' : 'fr' }}
                </p>
              </div>
              <div class="flex items-center justify-between gap-2">
                <button hlmBtn variant="ghost" size="sm" type="button" (click)="copyMediaId(media)">
                  Copier l'ID
                </button>
                <button
                  hlmBtn
                  variant="destructive"
                  size="sm"
                  type="button"
                  (click)="removeMedia(media)"
                >
                  Supprimer
                </button>
              </div>
            </div>
          </ui-card>
        }
      </div>
    } @else {
      <div
        class="rounded-lg border border-dashed border-border p-8 text-center text-muted-foreground"
      >
        Aucun média téléversé. Ajoutez vos premières images pour enrichir vos produits.
      </div>
    }
  }
</section>
