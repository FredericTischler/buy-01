<section class="mx-auto w-full max-w-6xl px-4 py-10">
  <header class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-3xl font-semibold tracking-tight text-foreground">Espace vendeur</h1>
      <p class="text-sm text-muted-foreground">
        Gérez vos produits, leurs stocks et leurs visuels depuis cette interface.
      </p>
    </div>
    <button hlmBtn type="button" (click)="openCreateDialog()">Ajouter un produit</button>
  </header>

  @if (loading()) {
    <ui-card>
      <div class="space-y-3">
        @for (row of [1, 2, 3, 4]; track row) {
          <ui-skeleton height="48px" />
        }
      </div>
    </ui-card>
  } @else {
    @if (products().length) {
      <div class="overflow-hidden rounded-lg border border-border">
        <table class="min-w-full divide-y divide-border text-sm">
          <thead
            class="bg-muted/50 text-left text-xs font-semibold uppercase tracking-wide text-muted-foreground"
          >
            <tr>
              <th class="px-4 py-3">Produit</th>
              <th class="px-4 py-3">Prix</th>
              <th class="px-4 py-3">Stock</th>
              <th class="px-4 py-3">Mise à jour</th>
              <th class="px-4 py-3 text-right">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-border bg-card">
            @for (product of products(); track trackByProduct($index, product)) {
              <tr>
                <td class="px-4 py-4">
                  <div class="font-medium text-foreground">{{ product.name }}</div>
                  <div class="text-xs text-muted-foreground line-clamp-1">
                    {{ product.description }}
                  </div>
                </td>
                <td class="px-4 py-4">
                  {{ product.price | currency: product.currency : 'symbol-narrow' : 'fr-FR' }}
                </td>
                <td class="px-4 py-4">{{ product.stock ?? 'N.C.' }}</td>
                <td class="px-4 py-4">{{ product.updatedAt | date: 'short' : '' : 'fr' }}</td>
                <td class="px-4 py-4 text-right">
                  <div class="flex justify-end gap-2">
                    <button
                      hlmBtn
                      variant="ghost"
                      size="sm"
                      type="button"
                      (click)="openEditDialog(product)"
                    >
                      Modifier
                    </button>
                    <button
                      hlmBtn
                      variant="destructive"
                      size="sm"
                      type="button"
                      (click)="removeProduct(product)"
                    >
                      Supprimer
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    } @else {
      <div
        class="rounded-lg border border-dashed border-border p-8 text-center text-muted-foreground"
      >
        Aucun produit publié. Ajoutez votre premier article pour le rendre visible dans le
        catalogue.
      </div>
    }
  }

  <ui-dialog
    [open]="dialogOpen()"
    (openChange)="dialogOpen.set($event)"
    (closed)="closeDialog()"
    [title]="editingProduct() ? 'Modifier le produit' : 'Nouveau produit'"
  >
    <form class="space-y-4" [formGroup]="productForm" (ngSubmit)="saveProduct()" novalidate>
      <div class="space-y-2">
        <label uiLabel for="product-name">Nom</label>
        <input id="product-name" uiInput placeholder="Nom du produit" formControlName="name" />
      </div>

      <div class="space-y-2">
        <label uiLabel for="product-description">Description</label>
        <textarea
          id="product-description"
          uiInput
          rows="4"
          placeholder="Décrivez votre produit avec précision"
          formControlName="description"
        ></textarea>
      </div>

      <div class="grid gap-4 sm:grid-cols-2">
        <div class="space-y-2">
          <label uiLabel for="product-price">Prix</label>
          <input
            id="product-price"
            type="number"
            min="0"
            step="0.01"
            uiInput
            formControlName="price"
          />
        </div>
        <div class="space-y-2">
          <label uiLabel for="product-currency">Devise</label>
          <select id="product-currency" uiInput formControlName="currency">
            <option value="EUR">EUR</option>
            <option value="USD">USD</option>
          </select>
        </div>
      </div>

      <div class="space-y-2">
        <label uiLabel for="product-stock">Stock</label>
        <input id="product-stock" type="number" min="0" uiInput formControlName="stock" />
      </div>

      <div class="space-y-2">
        <label uiLabel for="product-images">Images</label>
        <input
          id="product-images"
          uiInput
          placeholder="Identifiants d'images séparés par une virgule"
          formControlName="imageIds"
        />
        <p class="text-xs text-muted-foreground">
          Associez des médias existants (Media manager) en renseignant leurs identifiants.
        </p>
      </div>

      <div class="flex justify-end gap-3 pt-2">
        <button hlmBtn variant="ghost" type="button" (click)="closeDialog()">Annuler</button>
        <button hlmBtn type="submit" [disabled]="submitting()">
          <span *ngIf="!submitting(); else saving">Enregistrer</span>
        </button>
      </div>
    </form>
  </ui-dialog>

  <ng-template #saving>
    <span class="flex items-center gap-2">
      <span class="h-3 w-3 animate-ping rounded-full bg-primary"></span>
      Sauvegarde...
    </span>
  </ng-template>
</section>
