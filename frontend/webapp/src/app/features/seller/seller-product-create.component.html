<section class="mx-auto w-full max-w-3xl px-4 py-10 space-y-6">
  <button hlmBtn variant="ghost" type="button" routerLink="/seller">
    ← Retour à mes produits
  </button>

  <ui-card class="p-6">
    <form class="space-y-6" [formGroup]="form" (ngSubmit)="submit()" data-test="product-create-form">
      <div class="space-y-2">
        <label uiLabel for="product-name">Nom du produit</label>
        <input
          id="product-name"
          uiInput
          type="text"
          placeholder="Ex. Planche à découper artisanale"
          formControlName="name"
          autocomplete="off"
          data-test="product-name-input"
        />
        @if (controlHasError('name', 'required')) {
          <p class="text-xs text-destructive">Le nom du produit est obligatoire.</p>
        }
        @if (controlHasError('name', 'maxlength')) {
          <p class="text-xs text-destructive">120 caractères maximum.</p>
        }
        @if (apiError('name'); as message) {
          <p class="text-xs text-destructive">{{ message }}</p>
        }
      </div>

      <div class="space-y-2">
        <label uiLabel for="product-price">Prix</label>
        <input
          id="product-price"
          uiInput
          type="number"
          min="0.01"
          step="0.01"
          placeholder="0,00"
          formControlName="price"
          data-test="product-price-input"
        />
        @if (controlHasError('price', 'required')) {
          <p class="text-xs text-destructive">Le prix est obligatoire.</p>
        }
        @if (controlHasError('price', 'min')) {
          <p class="text-xs text-destructive">Le prix doit être supérieur à 0.</p>
        }
        @if (apiError('price'); as message) {
          <p class="text-xs text-destructive">{{ message }}</p>
        }
      </div>

      <div class="space-y-2">
        <label uiLabel for="product-description">Description (optionnelle)</label>
        <textarea
          id="product-description"
          uiInput
          rows="5"
          maxlength="500"
          placeholder="Décrivez brièvement les caractéristiques ou avantages de votre produit."
          formControlName="description"
          data-test="product-description-input"
        ></textarea>
        <p class="text-xs text-muted-foreground">500 caractères maximum.</p>
        @if (controlHasError('description', 'maxlength')) {
          <p class="text-xs text-destructive">La description est trop longue.</p>
        }
        @if (apiError('description'); as message) {
          <p class="text-xs text-destructive">{{ message }}</p>
        }
      </div>

      <div class="flex flex-col gap-3 pt-2 sm:flex-row sm:items-center sm:justify-end">
        <a hlmBtn variant="outline" routerLink="/seller">Annuler</a>
        <button hlmBtn type="submit" class="min-w-[160px]" [disabled]="submitting()" data-test="product-submit-button">
          <span *ngIf="!submitting(); else loading">Créer</span>
        </button>
      </div>
    </form>
  </ui-card>

  <ng-template #loading>
    <span class="flex items-center justify-center gap-2">
      <span class="h-3 w-3 animate-ping rounded-full bg-primary"></span>
      Création en cours...
    </span>
  </ng-template>
</section>
