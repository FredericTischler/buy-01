<section class="mx-auto w-full max-w-6xl px-4 py-10 space-y-6">
  <header
    class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between rounded-lg border border-border bg-card px-5 py-4"
  >
    <div class="space-y-1">
      <h1 class="text-2xl font-semibold tracking-tight text-foreground">Produits publiés</h1>
      <p class="text-sm text-muted-foreground">
        Retrouvez la liste de vos produits et gérez-les depuis cet espace vendeur.
      </p>
    </div>

    @if (canCreate()) {
      <button
        hlmBtn
        size="lg"
        class="inline-flex w-full items-center justify-center gap-2 sm:w-auto"
        type="button"
        (click)="navigateToCreate()"
        data-test="add-product-button"
      >
        <span aria-hidden="true">＋</span>
        Ajouter un produit
      </button>
    }
  </header>

  @if (showPostCreateCta()) {
    <ui-card class="flex flex-col gap-4 border border-primary/40 bg-primary/5 p-5 sm:flex-row sm:items-center sm:justify-between">
      <div class="space-y-1">
        <h2 class="text-base font-semibold text-foreground">Produit créé avec succès</h2>
        <p class="text-sm text-muted-foreground">
          Ajoutez des images depuis le Media Manager pour le rendre plus attractif.
        </p>
      </div>
      <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
        <a hlmBtn variant="outline" routerLink="/media" data-test="add-images-cta">Ajouter des images</a>
        <button hlmBtn variant="ghost" type="button" (click)="dismissPostCreateCta()">Ignorer</button>
      </div>
    </ui-card>
  }

  @if (loading()) {
    <ui-card>
      <div class="space-y-3">
        @for (row of [1, 2, 3, 4]; track row) {
          <ui-skeleton height="48px" />
        }
      </div>
    </ui-card>
  } @else {
    @if (products().length) {
      <div class="overflow-hidden rounded-lg border border-border bg-card">
        <table class="min-w-full divide-y divide-border text-sm">
          <thead
            class="bg-muted/60 text-left text-xs font-semibold uppercase tracking-wide text-muted-foreground"
          >
            <tr>
              <th class="px-4 py-3">Produit</th>
              <th class="px-4 py-3">Prix</th>
              <th class="px-4 py-3">Mise à jour</th>
              <th class="px-4 py-3">Médias</th>
              <th class="px-4 py-3 text-right">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-border">
            @for (product of products(); track trackByProduct($index, product)) {
              <tr>
                <td class="px-4 py-4">
                  <div class="font-medium text-foreground">{{ product.name }}</div>
                  <p class="text-xs text-muted-foreground line-clamp-1">
                    {{ product.description || 'Aucune description fournie.' }}
                  </p>
                </td>
                <td class="px-4 py-4">
                  {{ product.price | currency: 'EUR' : 'symbol-narrow' : 'fr-FR' }}
                </td>
                <td class="px-4 py-4">{{ product.updatedAt | date: 'short' : '' : 'fr' }}</td>
                <td class="px-4 py-4">{{ product.media?.length ?? 0 }}</td>
                <td class="px-4 py-4 text-right">
                  <button
                    hlmBtn
                    variant="destructive"
                    size="sm"
                    type="button"
                    (click)="removeProduct(product)"
                  >
                    Supprimer
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    } @else {
      <div class="rounded-lg border border-dashed border-border p-8 text-center text-muted-foreground">
        Aucun produit publié pour le moment. Lancez-vous en créant votre premier article.
      </div>
    }
  }
</section>
