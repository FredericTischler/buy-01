<section class="dashboard">
  <div class="card">
    <h2>{{ selectedProduct ? 'Modifier le produit' : 'Créer un produit' }}</h2>
    <form [formGroup]="productForm" (ngSubmit)="submitProduct()">
      <label>Nom</label>
      <input type="text" formControlName="name" />

      <label>Description</label>
      <textarea rows="4" formControlName="description"></textarea>

      <label>Prix (€)</label>
      <input type="number" formControlName="price" step="0.01" />

      <label>Images (PNG/JPEG ≤ 2 MB)</label>
      <input type="file" multiple accept="image/png,image/jpeg" (change)="onFilesSelected($event)" />

      <div class="media-preview" *ngIf="mediaSelections.length">
        <figure *ngFor="let media of mediaSelections">
          <img [src]="media.secureUrl" alt="Media" />
          <button type="button" (click)="removeMedia(media.mediaId)">Retirer</button>
        </figure>
      </div>

      <div class="actions">
        <button type="submit" [disabled]="saving">{{ selectedProduct ? 'Mettre à jour' : 'Créer' }}</button>
        <button type="button" (click)="resetForm()" [disabled]="saving">Réinitialiser</button>
      </div>
    </form>
    <p class="error-message" *ngIf="error">{{ error }}</p>
    <p class="success-message" *ngIf="success">{{ success }}</p>
  </div>

  <div class="card">
    <h2>Vos produits</h2>
    <p *ngIf="loadingProducts">Chargement...</p>
    <article class="product-list" *ngIf="!loadingProducts && products.length">
      <div class="product-item" *ngFor="let product of products">
        <div>
          <strong>{{ product.name }}</strong>
          <div>{{ product.price | currency: 'EUR' }}</div>
        </div>
        <div class="item-actions">
          <button type="button" (click)="editProduct(product)">Modifier</button>
          <button type="button" (click)="deleteProduct(product)">Supprimer</button>
        </div>
      </div>
    </article>
    <p *ngIf="!loadingProducts && !products.length">Ajoutez votre premier produit !</p>
  </div>
</section>
